###############################################################################
#
# IAR ANSI C/C++ Compiler V7.50.1.10123/W32 for ARM       23/Nov/2017  13:36:18
# Copyright 1999-2015 IAR Systems AB.
#
#    Cpu mode     =  thumb
#    Endian       =  little
#    Source file  =  F:\iar\NC199B-100\Library\Source\APP\User\app_lib.c
#    Command line =  
#        F:\iar\NC199B-100\Library\Source\APP\User\app_lib.c -D
#        USE_STDPERIPH_DRIVER -D _STM32F10X_HD -D STM32F10X_CL -D DEBUG -D
#        STM32F103RC -D STM32_FLASH_SIZE=256 -D HSE_VALUE=25000000 -lCN
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\..\Output\Lib\Debug-RC\List\
#        -o
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\..\Output\Lib\Debug-RC\Obj\
#        --no_unroll --no_inline --no_tbaa --no_scheduling --debug
#        --endian=little --cpu=Cortex-M3 -e --fpu=None --dlib_config
#        "C:\Program Files (x86)\IAR Systems\Embedded Workbench
#        7.3\arm\INC\c\DLib_Config_Full.h" -I
#        F:\iar\NC199B-100\Library\Project\IAR\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\User\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\AES\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\Config\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\OS\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\User\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\SIM900A\Source\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\SIM900A\Port\
#        -I F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\SIM900A\OS\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\SIM900A\Config\
#        -I F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\Protocol\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\Iap\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\Driver\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\IAR\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\Os\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\Os\uCOS-III\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\St\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\St\FWLib\CMSIS\CM3\CoreSupport\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\St\FWLib\CMSIS\CM3\DeviceSupport\ST\STM32F10x\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\St\FWLib\STM32F10x_StdPeriph_Driver\inc\
#        -I F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-CPU\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-CPU\ARM-Cortex-M3\IAR\
#        -I F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-LIB\
#        -I F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\Os\OSAL\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\OSAL\OS\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-MB\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-MB\Cfg\Template\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-MB\OS\uCOS-III\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-MB\Source\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-OS-III\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-OS-III\Ports\ARM-Cortex-M3\Generic\IAR\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-OS-III\Source\
#        -I F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\FatFs\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\FatFs\option\ -Om
#        --use_c++_inline -I "C:\Program Files (x86)\IAR Systems\Embedded
#        Workbench 7.3\arm\CMSIS\Include\"
#    List file    =  
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\..\Output\Lib\Debug-RC\List\app_lib.lst
#    Object file  =  
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\..\Output\Lib\Debug-RC\Obj\app_lib.o
#
###############################################################################

F:\iar\NC199B-100\Library\Source\APP\User\app_lib.c
      1          /*******************************************************************************
      2           *   Filename:       app_lib.c
      3           *   Revised:        All copyrights reserved to Wuming Shen.
      4           *   Date:           2014-07-05
      5           *   Revision:       v1.0
      6           *   Writer:	     Wuming Shen.
      7           *
      8           *   Description:    双击选中 wdt 按 Ctrl + H, 钩选 Match the case, Replace with
      9           *                   输入您要的名字，点击 Replace All
     10           *                   双击选中 Wdt 按 Ctrl + H, 钩选 Match the case, Replace with
     11           *                   输入您要的名字，点击 Replace All
     12           *                   双击选中 WDT 按 Ctrl + H, 钩选 Match the case, Replace with
     13           *                   输入您要的名字，点击 Replace All
     14           *                   在 app_cfg.h 中指定任务的优先级 和 任务堆栈大小
     15           *
     16           *   Notes:
     17           *					QQ:276193028
     18           *     				E-mail:shenchangwei945@163.com
     19           *
     20           *******************************************************************************/
     21          
     22          /*******************************************************************************
     23           * INCLUDES
     24           */
     25          #define  SNL_APP_SOURCE
     26          #include <app.h>
     27          #include <app_lib.h>
     28          #include <app_ctrl.h>
     29          
     30          #ifdef VSC_INCLUDE_SOURCE_FILE_NAMES
     31          const  CPU_CHAR  *app_lib__c = "$Id: $";
     32          #endif
     33          
     34          #define APP_TEMP_EN     DEF_ENABLED
     35          #if APP_TEMP_EN == DEF_ENABLED
     36          /*******************************************************************************
     37           * CONSTANTS
     38           */
     39          #define CYCLE_TIME_TICKS            (OS_TICKS_PER_SEC * 1)
     40          
     41          /*******************************************************************************
     42           * MACROS
     43           */
     44          
     45          /*******************************************************************************
     46           * TYPEDEFS
     47           */
     48               
     49          /*******************************************************************************
     50           * LOCAL VARIABLES
     51           */
     52          /***********************************************
     53          * 描述： NTC线性表
     54          */
     55          
     56          /*******************************************************************************
     57           * GLOBAL VARIABLES
     58           */
     59          extern          stcCtrlDCB              Ctrl;
     60          
     61          /*******************************************************************************
     62           * LOCAL FUNCTIONS
     63           */
     64          
     65          /*******************************************************************************
     66           * GLOBAL FUNCTIONS
     67           */
     68          
     69          /*******************************************************************************
     70           * EXTERN VARIABLES
     71           */
     72          
     73           /*******************************************************************************
     74           * EXTERN FUNCTIONS
     75           */
     76          
     77          /*******************************************************************************/
     78          
     79          /*******************************************************************************
     80          * 名    称： SWAP_INT16U
     81          * 功    能： 模拟的htons 或者 ntohs，如果系统支字节序更改可直接替换成系统函数
     82          * 入口参数： value
     83          * 出口参数： 更改过字节序的short数值
     84          * 作　　 者： Roger-WY.
     85          * 创建日期： 2015-06-25
     86          * 修    改：
     87          * 修改日期：
     88          * 备    注：
     89          *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
     90          INT16U SWAP_INT16U(INT16U value)                      
     91          {
   \                     SWAP_INT16U: (+1)
   \   00000000   0xB401             PUSH     {R0}
   \   00000002   0xB081             SUB      SP,SP,#+4
     92          	int16_t		tmp_value;
     93          	uint8_t		*index_1, *index_2;
     94          
     95          	index_1 = (uint8_t *)&tmp_value;
     96          	index_2 = (uint8_t *)&value;
     97          
     98          	*index_1 = *(index_2+1);
   \   00000004   0xF89D 0x0005      LDRB     R0,[SP, #+5]
   \   00000008   0xF88D 0x0000      STRB     R0,[SP, #+0]
     99          	*(index_1+1) = *index_2;
   \   0000000C   0xF89D 0x0004      LDRB     R0,[SP, #+4]
   \   00000010   0xF88D 0x0001      STRB     R0,[SP, #+1]
    100          
    101          	return tmp_value;
   \   00000014   0xF9BD 0x0000      LDRSH    R0,[SP, #+0]
   \   00000018   0xB280             UXTH     R0,R0
   \   0000001A   0xB002             ADD      SP,SP,#+8
   \   0000001C   0x4770             BX       LR               ;; return
    102          }
    103          /*******************************************************************************
    104           * 名    称： App_SetParaToEep
    105           * 功    能：
    106           * 入口参数：
    107           * 出口参数： 无
    108           * 作　 　者： 无名沈
    109           * 创建日期： 2014-03-28
    110           * 修    改：
    111           * 修改日期：
    112           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    113          BOOL App_SetParaToEep(INT16U addr, INT08U *pbuf, INT16U len)
    114          {
    115              INT08U    retrys    = 3;
    116              INT08U    ret;
    117              INT08U    *pc;
    118              INT08U    *pb;
    119          //    /***********************************************
    120          //    * 描述： 将默认参数写入EEPROM中
    121          //    */
    122          //    do {
    123          //        pb  = (INT08U   *)pbuf;
    124          //        pc  = (INT08U   *)&EepRdBuf;
    125          //        
    126          //        WdtReset();
    127          //        if ( len == BSP_EEP_WriteBytes( addr, pb, len ) ) {
    128          //            if ( len == BSP_EEP_ReadBytes( addr, pc, len ) ) {
    129          //                ret     = 1;
    130          //                for ( INT16U i = 0; i < len; i++ ) {
    131          //                    if ( *pb++ != *pc++ ) {
    132          //                        ret = 0;
    133          //                        break;
    134          //                    }
    135          //                }
    136          //                if ( ret )
    137          //                    break;
    138          //            }
    139          //        }
    140          //    } while ( --retrys );
    141          //    
    142          //    if ( !ret )
    143          //        return FALSE;
    144          //    
    145              return TRUE;
   \                     App_SetParaToEep: (+1)
   \   00000000   0x2001             MOVS     R0,#+1
   \   00000002   0x4770             BX       LR               ;; return
    146          }
    147          
    148          /*******************************************************************************
    149           * 名    称： App_SetParaToEeprom()
    150           * 功    能： 应用参数存储到EERPOM
    151           * 入口参数：
    152           * 出口参数： 无
    153           * 作　 　者：
    154           * 创建日期：
    155           * 修    改： 无名沈
    156           * 修改日期： 2014-06-25
    157           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    158          BOOL App_SetParaToEeprom(void)
    159          {
    160          //#if (STORAGE_TYPE == INTNER_FLASH )
    161          //    Ctrl.Para.dat.RestoreSetting    = 0xA5;
    162          //    //BSP_FlashWrite((INT32U  ) PARAM_START_ADDR + 0,
    163          //    //          (INT16U *)Ctrl.Para.buf2,128);
    164          //    BSP_FlashWriteBytes((u32) 0*2, (u8 *)Ctrl.Para.buf1, (u16) 128*2);
    165          //#elif (STORAGE_TYPE == INTNER_EEPROM )
    166          //#elif (STORAGE_TYPE == EXTERN_EEPROM )
    167          //    INT08U    ret;
    168          //    INT08U   *pb;
    169          //    
    170          //    pb    = (INT08U       *)&EepWrBuf;
    171          //    
    172          //    /***********************************************
    173          //    * 描述： 将默认参数写入EEPROM中
    174          //    */
    175          //    pb    = (INT08U   *)Ctrl.Para.buf1;
    176          //    ret   = App_SetParaToEep( 0, pb, 255 );
    177          //    
    178          //    if ( !ret )
    179          //        return FALSE;
    180          //    
    181          //    /***********************************************
    182          //    * 描述： 初始化数据标志写入EEPROM中
    183          //    */
    184          ////    if(!BSP_EEP_WriteByteChk(255, 0xA5)) {
    185          ////        return FALSE;
    186          ////    }
    187          //    
    188          //#endif
    189          //    return TRUE;
    190          }
   \                     App_SetParaToEeprom: (+1)
   \   00000000   0x4770             BX       LR               ;; return
    191          
    192          
    193          /*******************************************************************************
    194           * 名    称： App_SetParaToEeprom()
    195           * 功    能： 应用参数存储到EERPOM
    196           * 入口参数：
    197           * 出口参数： 无
    198           * 作　 　者：
    199           * 创建日期：
    200           * 修    改： 无名沈
    201           * 修改日期： 2014-06-25
    202           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    203          BOOL App_SetParaToSensor(INT08U dev, INT32U addr, INT08U *dat, INT16U len)
    204          {    
    205          //    INT08U   *pb    = dat;
    206          //    /***********************************************
    207          //    * 描述： 参数处理
    208          //    */
    209          //    if ( dat == NULL ) { 
    210          //        if ( dev == 2) { 
    211          //            //len     = 256;
    212          //            if ( addr < 256 ) {
    213          //                addr    = 0;
    214          //                pb    = (INT08U   *)Ctrl.Para.buf1;
    215          //            } else if ( addr < 512 ) {
    216          //                addr    = 256;
    217          //                pb    = (INT08U   *)Ctrl.Tab.buf1;
    218          //            }                
    219          //        } else { 
    220          //            addr    = 0;
    221          //            //len     = 256;
    222          //            Ctrl.Sen.Para.dat.ReadFlag    = 0xA5;
    223          //            pb    = (INT08U   *)Ctrl.Sen.Para.buf1;
    224          //        }
    225          //    }
    226          //    
    227          //    /***********************************************
    228          //    * 描述： 存在内部FLASH中
    229          //    */
    230          //#if (STORAGE_TYPE == INTNER_FLASH )
    231          //    BSP_FlashWriteBytes((u32) addr, (u8 *)pb, (u16) len);
    232          //    /***********************************************
    233          //    * 描述： 存在内部EEPROM中
    234          //    */
    235          //#elif (STORAGE_TYPE == INTNER_EEPROM )
    236          //    /***********************************************
    237          //    * 描述： 存在外部EEPROM中
    238          //    */
    239          //#elif (STORAGE_TYPE == EXTERN_EEPROM )
    240          //    
    241              INT08U    ret   = FALSE;
    242          //    
    243          //    BSP_I2CSetPort(dev);                              // 切换到I2C1
    244          //    
    245          //    /***********************************************
    246          //    * 描述： 将默认参数写入EEPROM中
    247          //    */
    248          //    ret   = App_SetParaToEep( addr, pb, len );
    249          //    
    250          //    if ( !ret ) {
    251          //        goto exit;
    252          //    }
    253          //    
    254          //    ret = TRUE;
    255          //#endif
    256          //exit:
    257          //    BSP_I2CSetPort(2);                              // 切换到I2C1
    258              return ret;
   \                     App_SetParaToSensor: (+1)
   \   00000000   0x2000             MOVS     R0,#+0
   \   00000002   0x4770             BX       LR               ;; return
    259          }
    260          
    261          extern  const StrParaRange MbsParaRange[];
    262          /*******************************************************************************
    263           * 名    称： App_GetParaFromEeprom()
    264           * 功    能： 应用参数读取到RAM
    265           * 入口参数：
    266           * 出口参数： 无
    267           * 作　 　者：
    268           * 创建日期：
    269           * 修    改： 无名沈
    270           * 修改日期： 2014-06-25
    271           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    272          BOOL App_GetParaFromEeprom(void)
    273          {    
    274          //#if (STORAGE_TYPE == INTNER_FLASH )    
    275          //    INT08U   *pb = (INT08U   *)&EepWrBuf;
    276          //    //BSP_FlashRead((INT32U  ) PARAM_START_ADDR + 0,
    277          //    //          (INT16U *)pu,127);
    278          //    BSP_FlashReadBytes((u32) 0*2, (u8 *)pb, (u16) 127*2);
    279          //#elif (STORAGE_TYPE == INTNER_EEPROM )
    280          //#elif (STORAGE_TYPE == EXTERN_EEPROM )
    281          //    INT08U   *pb = (INT08U   *)&EepWrBuf;
    282          //    /***********************************************
    283          //    * 描述： 已经配置过了，非首次初始化，则读取参数到RAM
    284          //    */
    285          //    /***********************************************
    286          //    * 描述： 读取MODBUS参数
    287          //    */
    288          //    
    289          //    INT08U  retrys  = 5;
    290          //    INT16U  len = 254;
    291          //    do {
    292          //        WdtReset();
    293          ////        if ( len == BSP_EEP_ReadBytes(0,(INT08U *)pb, len) ) {            
    294          ////            for ( INT08U i = 0; i < len; i++, pb++ ) {
    295          ////                Ctrl.Para.buf1[i] = *pb;
    296          ////            }
    297          ////            return TRUE;
    298          ////            //break;
    299          ////        }
    300          //#ifdef APP_LIBRARY
    301          //        Delay_Nms( 10 );
    302          //#else
    303          //        BSP_OS_TimeDly(10);
    304          //#endif
    305          //    } while( --retrys );
    306          //    
    307          //    if ( !retrys )
    308          //        return FALSE;
    309          //#endif
    310          //    /***********************************************
    311          //    * 描述： 缓冲区参数定入MODBUS参数
    312          //    */
    313          //    StrParaRange *prag    = Ctrl.Prge;
    314          //    
    315          //#if ( PARA_TYPE == PARA_TYPE_INT16U )
    316          //    INT16U  *pu = (INT16U*)pb;
    317          //    for ( INT08U i = 0; i < 127; i++, pu++,prag++ ) {
    318          //        if ( ( (INT16U)*pu >= prag->Min ) &&
    319          //            ( (INT16U)*pu <= prag->Max ) ) {
    320          //            Ctrl.Para.buf2[i] = *pu;
    321          //        }
    322          //    }
    323          //#elif ( PARA_TYPE == PARA_TYPE_INT16S )
    324          //    INT16S  *ps = (INT16S*)pb;
    325          //    for ( INT08U i = 0; i < 127; i++, ps++,prag++ ) {
    326          //        if ( ( (INT16S)*ps >= prag->Min ) &&
    327          //            ( (INT16S)*ps <= prag->Max ) ) {
    328          //            Ctrl.Para.buf2[i] = *ps;
    329          //        }
    330          //    }
    331          //#elif ( PARA_TYPE == PARA_TYPE_INT08U )
    332          //    for ( INT08U i = 0; i < 254; i++, pb++,prag++ ) {
    333          //        if ( ( (INT08U)*pb >= prag->Min ) &&
    334          //            ( (INT08U)*pb <= prag->Max ) ) {
    335          //            Ctrl.Para.buf1[i] = *pb;
    336          //        }
    337          //    }
    338          //#else
    339          //    for ( INT08U i = 0; i < 254; i++, pb++,prag++ ) {
    340          //        if ( ( (INT08S)*pb >= prag->Min ) &&
    341          //            ( (INT08S)*pb <= prag->Max ) ) {
    342          //            Ctrl.Para.buf1[i] = *pb;
    343          //        }
    344          //    }
    345          //#endif
    346          //    return TRUE;
    347          }
   \                     App_GetParaFromEeprom: (+1)
   \   00000000   0x4770             BX       LR               ;; return
    348          
    349          /*******************************************************************************
    350           * 名    称：
    351           * 功    能：
    352           * 入口参数：
    353           * 出口参数： 无
    354           * 作　 　者： 无名沈
    355           * 创建日期： 2014-03-28
    356           * 修    改：
    357           * 修改日期：
    358           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    359          BOOL App_PraInit(void)
    360          {
    361              extern const StrCtrlPara    MbsParaAtrIdx;
    362              
    363          //    Ctrl.Prge               = (StrParaRange *)MbsParaRange;
    364          //    //Ctrl.Key                = (StrKeyEvt *)&Key;
    365          //    Ctrl.Para.dat.idx       = &MbsParaAtrIdx;
    366          //    BSP_I2CSetPort(1);
    367          //#if (STORAGE_TYPE == INTNER_FLASH ) 
    368          //    BSP_FlashReadBytes((u32) 0*2, (u8 *)EepWrBuf.buf1, (u16) 128*2);
    369          //    INT16U dat = EepWrBuf.buf2[127];    
    370          //#elif (STORAGE_TYPE == INTNER_EEPROM )
    371          //#elif (STORAGE_TYPE == EXTERN_EEPROM )
    372          //    INT08U  dat     = 0;
    373          //    INT08U  retrys  = 10;
    374          //    BSP_EEP_Init();
    375          //    
    376          //    //if ( FALSE == BSP_EEP_Init())
    377          //    //    goto exit;                                 // 初始化存储器
    378          //    /***********************************************
    379          //    * 描述：读取初始化地址上的值
    380          //    */
    381          //    do {
    382          //        WdtReset();
    383          //        if ( TRUE == BSP_EEP_ReadByte(255, &dat))
    384          //            break;
    385          //#ifdef APP_LIBRARY
    386          //        Delay_Nms( 10 );
    387          //#else
    388          //        BSP_OS_TimeDly(10);
    389          //#endif
    390          //    } while( --retrys );
    391          //#endif
    392          //    WdtReset();
    393          //    /***********************************************
    394          //    * 描述：跟默认值比较
    395          //    */
    396          //    if(dat == 0xA5) {
    397          //        dat = App_GetParaFromEeprom();                  // 已经初始化，读取参数
    398          //        Ctrl.Sys.FirstPwrFlag       = FALSE;
    399          //        /***********************************************
    400          //        * 描述：没有初始化，保存默念值
    401          //        */
    402          //    } else { 
    403          //        dat = App_SetParaToEeprom();                    // 未初始化，保存默认参数
    404          //        Ctrl.Sys.FirstPwrFlag       = TRUE;
    405          //    }
    406          //           
    407          //    WdtReset();
    408          //    /***********************************************
    409          //    * 描述： 切换到显示模块存储器
    410          //    */
    411          //    //BSP_I2CSetPort(2);                              // 切换到I2C1
    412          //    return (BOOL)dat;
    413          }
   \                     App_PraInit: (+1)
   \   00000000   0x4770             BX       LR               ;; return
    414          
    415          /*******************************************************************************
    416           * 				                    延时函数                                   *
    417           *******************************************************************************/
    418          /*******************************************************************************
    419          * 名    称： Delay_Nus()
    420          * 功    能： 延时大概1us
    421          * 入口参数： dly		延时参数，值越大，延时越久
    422          * 出口参数： 无
    423          * 作　 　者： 无名沈
    424          * 创建日期： 2009-01-03
    425          * 修    改：
    426          * 修改日期：
    427          *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    428          OPTIMIZE_NONE void  Delay_Nus( INT32U  dly )
    429          {
    430              /***********************************************
    431              * 描述：定时器初始化
    432              *       72000000次循环  = 6.9999999583333333333333333333333秒
    433              *       一次循环 = 6.9999999583333333333333333333333 / 72000000
    434              *       = 97.222221643518518518518518518519 ns
    435              *       ~= 0.1 us
    436              *       延时1us  dly  = 9
    437              *       dly = 0时，循环一次
    438              *
    439              while(dly--);
    440              *//***********************************************
    441              * 描述：定时器初始化
    442              *       1000000次循环  = 1027.7778611111111111111111111111ms
    443              *       平均一次循环 = 1.02777786111111111111111111111us
    444              *       dly = 1时，= 1.1111111111111111111111111111111us
    445              *       dly = 2时  = 2.1388888888888888888888888888889us
    446              *       dly 每增加1 增加-1.0277777777777777777777777777778us
    447              */
    448              INT32U  i;
    449          
    450              while(dly--) {
   \                     Delay_Nus: (+1)
   \                     ??Delay_Nus_0: (+1)
   \   00000000   0x0002             MOVS     R2,R0
   \   00000002   0x1E50             SUBS     R0,R2,#+1
   \   00000004   0x2A00             CMP      R2,#+0
   \   00000006   0xD005             BEQ.N    ??Delay_Nus_1
    451                  for(i=0; i<7; i++);             // clk = 72000000 1027.7778611111111111111111111111
   \   00000008   0x2200             MOVS     R2,#+0
   \   0000000A   0x0011             MOVS     R1,R2
   \                     ??Delay_Nus_2: (+1)
   \   0000000C   0x2907             CMP      R1,#+7
   \   0000000E   0xD2F7             BCS.N    ??Delay_Nus_0
   \   00000010   0x1C49             ADDS     R1,R1,#+1
   \   00000012   0xE7FB             B.N      ??Delay_Nus_2
    452              }
    453          }
   \                     ??Delay_Nus_1: (+1)
   \   00000014   0x4770             BX       LR               ;; return
    454          
    455          /*******************************************************************************
    456          * 名    称： Delay_Nms()
    457          * 功    能： 延时大概1ms
    458          * 入口参数： dly		延时参数，值越大，延时越久
    459          * 出口参数： 无
    460          * 作　 　者： 无名沈
    461          * 创建日期： 2009-01-03
    462          * 修    改：
    463          * 修改日期：
    464          *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    465          OPTIMIZE_NONE void  Delay_Nms( INT32U  dly )
    466          {
   \                     Delay_Nms: (+1)
   \   00000000   0xB5F8             PUSH     {R3-R7,LR}
   \   00000002   0x0004             MOVS     R4,R0
    467          #if UCOS_II_EN > 0
    468              OSTimeDly(dly);
    469          #else
    470              CPU_INT32U  hclk_freq;
    471              CPU_INT32U  cnts;
    472              INT32U      i;
    473          
    474              hclk_freq   = BSP_CPU_ClkFreq();            // hclk_freq = 72000000时dly 1000 接近1秒
   \   00000004   0x.... 0x....      BL       BSP_CPU_ClkFreq
   \   00000008   0x0005             MOVS     R5,R0
    475              cnts        = hclk_freq / 9000;
   \   0000000A   0xF242 0x3028      MOVW     R0,#+9000
   \   0000000E   0xFBB5 0xF0F0      UDIV     R0,R5,R0
   \   00000012   0x0006             MOVS     R6,R0
    476              //WdtReset();
    477          
    478              for( ; dly > 0; dly-- ) {
   \                     ??Delay_Nms_0: (+1)
   \   00000014   0x2C00             CMP      R4,#+0
   \   00000016   0xD007             BEQ.N    ??Delay_Nms_1
    479                  for(i=0; i<cnts; i++);
   \   00000018   0x2000             MOVS     R0,#+0
   \   0000001A   0x0007             MOVS     R7,R0
   \                     ??Delay_Nms_2: (+1)
   \   0000001C   0x42B7             CMP      R7,R6
   \   0000001E   0xD201             BCS.N    ??Delay_Nms_3
   \   00000020   0x1C7F             ADDS     R7,R7,#+1
   \   00000022   0xE7FB             B.N      ??Delay_Nms_2
    480              }
   \                     ??Delay_Nms_3: (+1)
   \   00000024   0x1E64             SUBS     R4,R4,#+1
   \   00000026   0xE7F5             B.N      ??Delay_Nms_0
    481          #endif
    482          }
   \                     ??Delay_Nms_1: (+1)
   \   00000028   0xBDF1             POP      {R0,R4-R7,PC}    ;; return
    483          
    484          /*******************************************************************************
    485          * 名    称：Delay_Ns()
    486          * 功    能：延时大概1s
    487          * 入口参数：dly		延时参数，值越大，延时越久
    488          * 出口参数：无
    489          * 作　 　者：无名沈
    490          * 创建日期：2009-01-03
    491          * 修    改：
    492          * 修改日期：
    493          *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    494          OPTIMIZE_NONE void  Delay_Ns( INT32U  dly )
    495          {
   \                     Delay_Ns: (+1)
   \   00000000   0xB510             PUSH     {R4,LR}
   \   00000002   0x0004             MOVS     R4,R0
    496          #if UCOS_II_EN > 0
    497              OSTimeDlyHMSM(dly/3600,dly/60%60,dly%3600,0);
    498          #else
    499              for( ; dly > 0; dly--) {
   \                     ??Delay_Ns_0: (+1)
   \   00000004   0x2C00             CMP      R4,#+0
   \   00000006   0xD005             BEQ.N    ??Delay_Ns_1
    500                  //WdtReset();
    501                  Delay_Nms( 950 );
   \   00000008   0xF240 0x30B6      MOVW     R0,#+950
   \   0000000C   0x.... 0x....      BL       Delay_Nms
    502              }
   \   00000010   0x1E64             SUBS     R4,R4,#+1
   \   00000012   0xE7F7             B.N      ??Delay_Ns_0
    503          #endif
    504          }
   \                     ??Delay_Ns_1: (+1)
   \   00000014   0xBD10             POP      {R4,PC}          ;; return
    505          
    506          /*******************************************************************************
    507           * 				                    end of file                                *
    508           *******************************************************************************/
    509          #endif

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       0   App_GetParaFromEeprom
       0   App_PraInit
       0   App_SetParaToEep
       0   App_SetParaToEeprom
       0   App_SetParaToSensor
      24   Delay_Nms
        24   -> BSP_CPU_ClkFreq
       8   Delay_Ns
         8   -> Delay_Nms
       0   Delay_Nus
       8   SWAP_INT16U


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       2  App_GetParaFromEeprom
       2  App_PraInit
       4  App_SetParaToEep
       2  App_SetParaToEeprom
       4  App_SetParaToSensor
      42  Delay_Nms
      22  Delay_Ns
      22  Delay_Nus
      30  SWAP_INT16U

 
 130 bytes in section .text
 
 130 bytes of CODE memory

Errors: none
Warnings: 7
