###############################################################################
#
# IAR ANSI C/C++ Compiler V7.40.1.8447/W32 for ARM        13/Feb/2017  13:48:14
# Copyright 1999-2015 IAR Systems AB.
#
#    Cpu mode     =  thumb
#    Endian       =  little
#    Source file  =  
#        V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Source\Micrium\uC-OS-III\Source\os_prio.c
#    Command line =  
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Source\Micrium\uC-OS-III\Source\os_prio.c" -D
#        USE_STDPERIPH_DRIVER -D STM32F10X_HD -D DEBUG -D STM32F103RB -D
#        STM32_FLASH_SIZE=128 -lCN "V:\我的项目\04
#        长沙南车\2015年后项目\NC16-011-A 智能电表\04 程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\Debug-RB\List\" -o "V:\我的项目\04
#        长沙南车\2015年后项目\NC16-011-A 智能电表\04 程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\Debug-RB\Obj\" --debug --endian=little
#        --cpu=ARM7TDMI -e --fpu=None --dlib_config "D:\Program Files (x86)\IAR
#        Systems\Embedded Workbench 7.2\arm\INC\c\DLib_Config_Normal.h" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01 智能电表\Library\Project\IAR\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\APP\" -I "V:\我的项目\04
#        长沙南车\2015年后项目\NC16-011-A 智能电表\04 程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\APP\User\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\APP\AES\" -I "V:\我的项目\04
#        长沙南车\2015年后项目\NC16-011-A 智能电表\04 程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\APP\Config\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\APP\OS\" -I "V:\我的项目\04
#        长沙南车\2015年后项目\NC16-011-A 智能电表\04 程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\APP\User\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\APP\SIM900A\Source\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\APP\SIM900A\Port\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\APP\SIM900A\OS\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\APP\SIM900A\Config\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\APP\Protocol\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\BSP\" -I "V:\我的项目\04
#        长沙南车\2015年后项目\NC16-011-A 智能电表\04 程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\BSP\Driver\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\BSP\IAR\" -I "V:\我的项目\04
#        长沙南车\2015年后项目\NC16-011-A 智能电表\04 程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\BSP\Os\" -I "V:\我的项目\04
#        长沙南车\2015年后项目\NC16-011-A 智能电表\04 程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\BSP\Os\uCOS-III\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\BSP\St\" -I "V:\我的项目\04
#        长沙南车\2015年后项目\NC16-011-A 智能电表\04 程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\BSP\St\FWLib\CMSIS\CM3\CoreSupport\"
#        -I "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\BSP\St\FWLib\CMSIS\CM3\DeviceSupport\ST\STM32F10x\"
#        -I "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\BSP\St\FWLib\STM32F10x_StdPeriph_Driver\inc\"
#        -I "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\Micrium\uC-CPU\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\Micrium\uC-CPU\ARM-Cortex-M3\IAR\"
#        -I "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\Micrium\uC-LIB\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\BSP\Os\OSAL\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\OSAL\OS\" -I "V:\我的项目\04
#        长沙南车\2015年后项目\NC16-011-A 智能电表\04 程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\Micrium\uC-MB\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\Micrium\uC-MB\Cfg\Template\"
#        -I "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\Micrium\uC-MB\OS\uCOS-III\"
#        -I "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\Micrium\uC-MB\Source\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\Micrium\uC-OS-III\" -I
#        "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\Micrium\uC-OS-III\Ports\ARM-Cortex-M3\Generic\IAR\"
#        -I "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\Micrium\uC-OS-III\Source\"
#        -I "V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\FatFs\" -I "V:\我的项目\04
#        长沙南车\2015年后项目\NC16-011-A 智能电表\04 程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\..\..\Source\FatFs\option\" --cpu_mode
#        thumb -Oh --use_c++_inline
#    List file    =  
#        V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\Debug-RB\List\os_prio.lst
#    Object file  =  
#        V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04
#        程序\NC014-001-000.CX_01
#        智能电表\Library\Project\IAR\Debug-RB\Obj\os_prio.o
#
###############################################################################

V:\我的项目\04 长沙南车\2015年后项目\NC16-011-A 智能电表\04 程序\NC014-001-000.CX_01 智能电表\Library\Source\Micrium\uC-OS-III\Source\os_prio.c
      1          /*
      2          ************************************************************************************************************************
      3          *                                                      uC/OS-III
      4          *                                                 The Real-Time Kernel
      5          *
      6          *                                  (c) Copyright 2009-2012; Micrium, Inc.; Weston, FL
      7          *                           All rights reserved.  Protected by international copyright laws.
      8          *
      9          *                                                 PRIORITY MANAGEMENT
     10          *
     11          * File    : OS_PRIO.C
     12          * By      : JJL
     13          * Version : V3.03.01
     14          *
     15          * LICENSING TERMS:
     16          * ---------------
     17          *           uC/OS-III is provided in source form for FREE short-term evaluation, for educational use or 
     18          *           for peaceful research.  If you plan or intend to use uC/OS-III in a commercial application/
     19          *           product then, you need to contact Micrium to properly license uC/OS-III for its use in your 
     20          *           application/product.   We provide ALL the source code for your convenience and to help you 
     21          *           experience uC/OS-III.  The fact that the source is provided does NOT mean that you can use 
     22          *           it commercially without paying a licensing fee.
     23          *
     24          *           Knowledge of the source code may NOT be used to develop a similar product.
     25          *
     26          *           Please help us continue to provide the embedded community with the finest software available.
     27          *           Your honesty is greatly appreciated.
     28          *
     29          *           You can contact us at www.micrium.com, or by phone at +1 (954) 217-2036.
     30          ************************************************************************************************************************
     31          */
     32          
     33          #define  MICRIUM_SOURCE
     34          #include <os.h>
     35          
     36          #ifdef VSC_INCLUDE_SOURCE_FILE_NAMES
     37          const  CPU_CHAR  *os_prio__c = "$Id: $";
     38          #endif
     39          
     40          

   \                                 In section .bss, align 4
     41          CPU_DATA   OSPrioTbl[OS_PRIO_TBL_SIZE];                     /* Declare the array local to this file to allow for  ... */
   \                     OSPrioTbl:
   \   00000000                      DS8 4
     42                                                                      /* ... optimization.  In other words, this allows the ... */
     43                                                                      /* ... table to be located in fast memory                 */
     44          
     45          /*
     46          ************************************************************************************************************************
     47          *                                               INITIALIZE THE PRIORITY LIST
     48          *
     49          * Description: This function is called by uC/OS-III to initialize the list of ready priorities.
     50          *
     51          * Arguments  : none
     52          *
     53          * Returns    : none
     54          *
     55          * Note       : This function is INTERNAL to uC/OS-III and your application should not call it.
     56          ************************************************************************************************************************
     57          */
     58          

   \                                 In section .text, align 2, keep-with-next
     59          void  OS_PrioInit (void)
     60          {
     61              CPU_DATA  i;
     62          
     63          
     64                                                                      /* Clear the bitmap table ... no task is ready            */
     65              for (i = 0u; i < OS_PRIO_TBL_SIZE; i++) {
     66                   OSPrioTbl[i] = (CPU_DATA)0;
   \                     OS_PrioInit: (+1)
   \   00000000   0x2000             MOVS     R0,#+0
   \   00000002   0x....             LDR      R1,??DataTable3
   \   00000004   0x6008             STR      R0,[R1, #+0]
     67              }
     68          }
   \   00000006   0x4770             BX       LR               ;; return
     69          
     70          /*
     71          ************************************************************************************************************************
     72          *                                           GET HIGHEST PRIORITY TASK WAITING
     73          *
     74          * Description: This function is called by other uC/OS-III services to determine the highest priority task
     75          *              waiting on the event.
     76          *
     77          * Arguments  : none
     78          *
     79          * Returns    : The priority of the Highest Priority Task (HPT) waiting for the event
     80          *
     81          * Note(s)    : 1) This function is INTERNAL to uC/OS-III and your application MUST NOT call it.
     82          ************************************************************************************************************************
     83          */
     84          

   \                                 In section .text, align 2, keep-with-next
     85          OS_PRIO  OS_PrioGetHighest (void)
     86          {
   \                     OS_PrioGetHighest: (+1)
   \   00000000   0xB510             PUSH     {R4,LR}
     87              CPU_DATA  *p_tbl;
     88              OS_PRIO    prio;
     89          
     90          
     91              prio  = (OS_PRIO)0;
   \   00000002   0x2400             MOVS     R4,#+0
     92              p_tbl = &OSPrioTbl[0];
   \   00000004   0x....             LDR      R1,??DataTable3
   \   00000006   0xE001             B        ??OS_PrioGetHighest_0
     93              while (*p_tbl == (CPU_DATA)0) {                         /* Search the bitmap table for the highest priority       */
     94                  prio += DEF_INT_CPU_NBR_BITS;                       /* Compute the step of each CPU_DATA entry                */
   \                     ??OS_PrioGetHighest_1: (+1)
   \   00000008   0x3420             ADDS     R4,R4,#+32
     95                  p_tbl++;
   \   0000000A   0x1D09             ADDS     R1,R1,#+4
     96              }
   \                     ??OS_PrioGetHighest_0: (+1)
   \   0000000C   0x6808             LDR      R0,[R1, #+0]
   \   0000000E   0x2800             CMP      R0,#+0
   \   00000010   0xD0FA             BEQ      ??OS_PrioGetHighest_1
     97              prio += (OS_PRIO)CPU_CntLeadZeros(*p_tbl);              /* Find the position of the first bit set at the entry    */
     98              return (prio);
   \   00000012   0x.... 0x....      BL       CPU_CntLeadZeros
   \   00000016   0x1820             ADDS     R0,R4,R0
   \   00000018   0x0600             LSLS     R0,R0,#+24
   \   0000001A   0x0E00             LSRS     R0,R0,#+24
   \   0000001C   0xBD10             POP      {R4,PC}          ;; return
     99          }
    100          
    101          /*
    102          ************************************************************************************************************************
    103          *                                                  INSERT PRIORITY
    104          *
    105          * Description: This function is called to insert a priority in the priority table.
    106          *
    107          * Arguments  : prio     is the priority to insert
    108          *
    109          * Returns    : none
    110          *
    111          * Note(s)    : 1) This function is INTERNAL to uC/OS-III and your application MUST NOT call it.
    112          ************************************************************************************************************************
    113          */
    114          

   \                                 In section .text, align 2, keep-with-next
    115          void  OS_PrioInsert (OS_PRIO  prio)
    116          {
   \                     OS_PrioInsert: (+1)
   \   00000000   0xB410             PUSH     {R4}
    117              CPU_DATA  bit;
    118              CPU_DATA  bit_nbr;
    119              OS_PRIO   ix;
    120          
    121          
    122              ix             = prio / DEF_INT_CPU_NBR_BITS;
   \   00000002   0x0941             LSRS     R1,R0,#+5
    123              bit_nbr        = (CPU_DATA)prio & (DEF_INT_CPU_NBR_BITS - 1u);
    124              bit            = 1u;
    125              bit          <<= (DEF_INT_CPU_NBR_BITS - 1u) - bit_nbr;
    126              OSPrioTbl[ix] |= bit;
   \   00000004   0x....             LDR      R2,??DataTable3
   \   00000006   0x0089             LSLS     R1,R1,#+2
   \   00000008   0x1851             ADDS     R1,R2,R1
   \   0000000A   0x680A             LDR      R2,[R1, #+0]
   \   0000000C   0x2301             MOVS     R3,#+1
   \   0000000E   0x241F             MOVS     R4,#+31
   \   00000010   0x06C0             LSLS     R0,R0,#+27
   \   00000012   0x0EC0             LSRS     R0,R0,#+27
   \   00000014   0x1A20             SUBS     R0,R4,R0
   \   00000016   0x4083             LSLS     R3,R3,R0
   \   00000018   0x4313             ORRS     R3,R3,R2
   \   0000001A   0x600B             STR      R3,[R1, #+0]
    127          }
   \   0000001C   0xBC10             POP      {R4}
   \   0000001E   0x4770             BX       LR               ;; return
    128          
    129          /*
    130          ************************************************************************************************************************
    131          *                                                   REMOVE PRIORITY
    132          *
    133          * Description: This function is called to remove a priority in the priority table.
    134          *
    135          * Arguments  : prio     is the priority to remove
    136          *
    137          * Returns    : none
    138          *
    139          * Note(s)    : 1) This function is INTERNAL to uC/OS-III and your application MUST NOT call it.
    140          ************************************************************************************************************************
    141          */
    142          

   \                                 In section .text, align 2, keep-with-next
    143          void  OS_PrioRemove (OS_PRIO  prio)
    144          {
   \                     OS_PrioRemove: (+1)
   \   00000000   0xB410             PUSH     {R4}
    145              CPU_DATA  bit;
    146              CPU_DATA  bit_nbr;
    147              OS_PRIO   ix;
    148          
    149          
    150              ix             = prio / DEF_INT_CPU_NBR_BITS;
   \   00000002   0x0941             LSRS     R1,R0,#+5
    151              bit_nbr        = (CPU_DATA)prio & (DEF_INT_CPU_NBR_BITS - 1u);
    152              bit            = 1u;
    153              bit          <<= (DEF_INT_CPU_NBR_BITS - 1u) - bit_nbr;
    154              OSPrioTbl[ix] &= ~bit;
   \   00000004   0x....             LDR      R2,??DataTable3
   \   00000006   0x0089             LSLS     R1,R1,#+2
   \   00000008   0x1851             ADDS     R1,R2,R1
   \   0000000A   0x680A             LDR      R2,[R1, #+0]
   \   0000000C   0x2301             MOVS     R3,#+1
   \   0000000E   0x241F             MOVS     R4,#+31
   \   00000010   0x06C0             LSLS     R0,R0,#+27
   \   00000012   0x0EC0             LSRS     R0,R0,#+27
   \   00000014   0x1A20             SUBS     R0,R4,R0
   \   00000016   0x4083             LSLS     R3,R3,R0
   \   00000018   0x439A             BICS     R2,R2,R3
   \   0000001A   0x600A             STR      R2,[R1, #+0]
    155          }
   \   0000001C   0xBC10             POP      {R4}
   \   0000001E   0x4770             BX       LR               ;; return

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable3:
   \   00000000   0x........         DC32     OSPrioTbl

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       8   OS_PrioGetHighest
         8   -> CPU_CntLeadZeros
       0   OS_PrioInit
       4   OS_PrioInsert
       4   OS_PrioRemove


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable3
       4  OSPrioTbl
      30  OS_PrioGetHighest
       8  OS_PrioInit
      32  OS_PrioInsert
      32  OS_PrioRemove

 
   4 bytes in section .bss
 106 bytes in section .text
 
 106 bytes of CODE memory
   4 bytes of DATA memory

Errors: none
Warnings: none
