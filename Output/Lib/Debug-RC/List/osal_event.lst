###############################################################################
#
# IAR ANSI C/C++ Compiler V7.50.1.10123/W32 for ARM       26/Dec/2017  15:21:36
# Copyright 1999-2015 IAR Systems AB.
#
#    Cpu mode     =  thumb
#    Endian       =  little
#    Source file  =  F:\iar\NC199B-100\Library\Source\OSAL\OS\osal_event.c
#    Command line =  
#        F:\iar\NC199B-100\Library\Source\OSAL\OS\osal_event.c -D
#        USE_STDPERIPH_DRIVER -D _STM32F10X_HD -D STM32F10X_CL -D DEBUG -D
#        STM32F103RC -D STM32_FLASH_SIZE=256 -D HSE_VALUE=25000000 -lCN
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\..\Output\Lib\Debug-RC\List\
#        -o
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\..\Output\Lib\Debug-RC\Obj\
#        --no_unroll --no_inline --no_tbaa --no_scheduling --debug
#        --endian=little --cpu=Cortex-M3 -e --fpu=None --dlib_config
#        "C:\Program Files (x86)\IAR Systems\Embedded Workbench
#        7.3\arm\INC\c\DLib_Config_Full.h" -I
#        F:\iar\NC199B-100\Library\Project\IAR\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\User\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\AES\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\Config\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\OS\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\User\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\SIM900A\Source\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\SIM900A\Port\
#        -I F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\SIM900A\OS\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\SIM900A\Config\
#        -I F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\Protocol\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\APP\Iap\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\Driver\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\IAR\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\Os\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\Os\uCOS-III\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\St\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\St\FWLib\CMSIS\CM3\CoreSupport\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\St\FWLib\CMSIS\CM3\DeviceSupport\ST\STM32F10x\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\St\FWLib\STM32F10x_StdPeriph_Driver\inc\
#        -I F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-CPU\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-CPU\ARM-Cortex-M3\IAR\
#        -I F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-LIB\
#        -I F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\BSP\Os\OSAL\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\OSAL\OS\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-MB\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-MB\Cfg\Template\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-MB\OS\uCOS-III\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-MB\Source\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-OS-III\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-OS-III\Ports\ARM-Cortex-M3\Generic\IAR\
#        -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\Micrium\uC-OS-III\Source\
#        -I F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\FatFs\ -I
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\Source\FatFs\option\ -Om
#        --use_c++_inline -I "C:\Program Files (x86)\IAR Systems\Embedded
#        Workbench 7.3\arm\CMSIS\Include\"
#    List file    =  
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\..\Output\Lib\Debug-RC\List\osal_event.lst
#    Object file  =  
#        F:\iar\NC199B-100\Library\Project\IAR\..\..\..\Output\Lib\Debug-RC\Obj\osal_event.o
#
###############################################################################

F:\iar\NC199B-100\Library\Source\OSAL\OS\osal_event.c
      1          /*******************************************************************************
      2           *   Filename:      @osal_event.c
      3           *   Revised:
      4           *   Revision:
      5           *   Writer:        @Wuming Shen.
      6           *
      7           *   Description:
      8           *
      9           *   Notes:
     10           *
     11           *
     12           *   All copyrights reserved to Wuming Shen.
     13           *
     14           *******************************************************************************/
     15          
     16          /*******************************************************************************
     17           * INCLUDES
     18           */
     19          #include <osal.h>
     20          #include <osal_event.h>
     21          #include <osal_memory.h>
     22          
     23          #if OSAL_EVENT_EN > 0
     24          /*******************************************************************************
     25           * CONSTANTS
     26           */
     27          
     28          /*******************************************************************************
     29           * TYPEDEFS
     30           */
     31          
     32          /*******************************************************************************
     33           * MACROS
     34           */
     35          
     36          /*******************************************************************************
     37           * LOCAL VARIABLES
     38           */
     39          
     40          /*******************************************************************************
     41           * GLOBAL VARIABLES
     42           */

   \                                 In section .bss, align 4
     43          OsalTadkREC_t   *TaskHead;      //the point to link'head
   \                     TaskHead:
   \   00000000                      DS8 4
     44          OsalTadkREC_t   *TaskActive;
   \                     TaskActive:
   \   00000004                      DS8 4
     45          osalTid           Task_id;
   \                     Task_id:
   \   00000008                      DS8 4
     46          
     47          #if OSAL_MEM_EN == 0

   \                                 In section .bss, align 4
     48          OsalTadkREC_t   Task[OSAL_MAX_TASKS];
   \                     Task:
   \   00000000                      DS8 240
     49          #endif
     50          
     51          /***********************************************
     52          * 描述： OS接口
     53          */
     54          #if (UCOS_EN == DEF_ENABLED ) && ( OS_VERSION > 30000U )

   \                                 In section .bss, align 4
     55          OS_SEM           Osal_EvtSem;               // 信号量
   \                     Osal_EvtSem:
   \   00000000                      DS8 28
     56          #endif
     57          
     58          /*******************************************************************************
     59           * LOCAL FUNCTIONS
     60           */
     61          
     62          /*******************************************************************************
     63           * GLOBAL FUNCTIONS
     64           */
     65          
     66          /*******************************************************************************
     67           * EXTERN VARIABLES
     68           */
     69          
     70           /*******************************************************************************
     71           * EXTERN FUNCTIONS
     72           */
     73          
     74          /*******************************************************************************
     75           * @fn       osal_init_TaskHead
     76           *
     77           * @brief   init task link's head
     78           *
     79           * @param   none
     80           *
     81           * @return
     82           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
     83          void  osal_init_TaskHead(void )
     84          {
     85          #if OSAL_MEM_EN == 0
     86              byte       idx;
     87              for ( idx = 0; idx < OSAL_MAX_TASKS; idx++ ) {
   \                     osal_init_TaskHead: (+1)
   \   00000000   0x2000             MOVS     R0,#+0
   \   00000002   0xE00C             B.N      ??osal_init_TaskHead_0
     88                  Task[idx].next              = (void *)NULL;
   \                     ??osal_init_TaskHead_1: (+1)
   \   00000004   0x....             LDR.N    R1,??DataTable4
   \   00000006   0xEB00 0x0240      ADD      R2,R0,R0, LSL #+1
   \   0000000A   0xEB01 0x01C2      ADD      R1,R1,R2, LSL #+3
   \   0000000E   0x2200             MOVS     R2,#+0
   \   00000010   0x600A             STR      R2,[R1, #+0]
     89                  Task[idx].events            = 0;
   \   00000012   0x614A             STR      R2,[R1, #+20]
     90                  Task[idx].taskID            = 0;
   \   00000014   0x60CA             STR      R2,[R1, #+12]
     91                  Task[idx].taskPriority      = 0;
   \   00000016   0x740A             STRB     R2,[R1, #+16]
     92                  Task[idx].pfnInit           = (void *)0;
   \   00000018   0x604A             STR      R2,[R1, #+4]
     93                  Task[idx].pfnEventProcessor = (void *)0;
   \   0000001A   0x608A             STR      R2,[R1, #+8]
     94              }
   \   0000001C   0x1C40             ADDS     R0,R0,#+1
   \                     ??osal_init_TaskHead_0: (+1)
   \   0000001E   0x280A             CMP      R0,#+10
   \   00000020   0xDBF0             BLT.N    ??osal_init_TaskHead_1
     95          #endif
     96              TaskHead    = (OsalTadkREC_t *)NULL;
   \   00000022   0x....             LDR.N    R0,??DataTable4_1
   \   00000024   0x2100             MOVS     R1,#+0
   \   00000026   0x6001             STR      R1,[R0, #+0]
     97              TaskActive  = (OsalTadkREC_t *)NULL;
   \   00000028   0x6041             STR      R1,[R0, #+4]
     98              Task_id     = 0;
   \   0000002A   0x6081             STR      R1,[R0, #+8]
     99          
    100           }
   \   0000002C   0x4770             BX       LR               ;; return
    101          
    102          /*******************************************************************************
    103           * @fn       osal_Task_init
    104           *
    105           * @brief   init task
    106           *
    107           * @param   none
    108           *
    109           * @return
    110           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    111          void  osal_Task_init(void)
    112          {
   \                     osal_Task_init: (+1)
   \   00000000   0xB510             PUSH     {R4,LR}
    113              TaskActive = TaskHead;
   \   00000002   0x....             LDR.N    R4,??DataTable4_1
   \   00000004   0x6820             LDR      R0,[R4, #+0]
   \   00000006   0x6060             STR      R0,[R4, #+4]
   \   00000008   0xE006             B.N      ??osal_Task_init_0
    114          
    115              while(TaskActive) {
    116                  if(TaskActive->pfnInit) {
   \                     ??osal_Task_init_1: (+1)
   \   0000000A   0x6840             LDR      R0,[R0, #+4]
   \   0000000C   0x0001             MOVS     R1,R0
   \   0000000E   0xD000             BEQ.N    ??osal_Task_init_2
    117                       TaskActive->pfnInit();
   \   00000010   0x4780             BLX      R0
    118                  }
    119                  TaskActive = TaskActive->next;
   \                     ??osal_Task_init_2: (+1)
   \   00000012   0x6860             LDR      R0,[R4, #+4]
   \   00000014   0x6800             LDR      R0,[R0, #+0]
   \   00000016   0x6060             STR      R0,[R4, #+4]
    120              }
   \                     ??osal_Task_init_0: (+1)
   \   00000018   0x6860             LDR      R0,[R4, #+4]
   \   0000001A   0x2800             CMP      R0,#+0
   \   0000001C   0xD1F5             BNE.N    ??osal_Task_init_1
    121              TaskActive = (OsalTadkREC_t *)NULL;
    122          }
   \   0000001E   0xBD10             POP      {R4,PC}          ;; return
    123          /*******************************************************************************
    124          * 修改记录：20140510 增加INT8U id参数，用以任务ID自由分配取代任务ID系统分配
    125          */

   \                                 In section .text, align 2, keep-with-next
    126           void  osal_add_Task(pTaskInitFn pfnInit,
    127                                pTaskEventHandlerFn pfnEventProcessor,
    128                                osalPrio taskPriority,osalTid id)
    129          {
   \                     osal_add_Task: (+1)
   \   00000000   0xB4F0             PUSH     {R4-R7}
    130              OsalTadkREC_t  *TaskNew;
    131              OsalTadkREC_t  *TaskSech;
    132              OsalTadkREC_t  **TaskPTR;
    133          #if OSAL_MEM_EN > 0
    134              TaskNew = osal_mem_alloc(sizeof( OsalTadkREC_t));
    135          #else
    136              byte           idx;
    137              for ( idx = 0; idx < OSAL_MAX_TASKS; idx++ ) {//查找空闲的任务资源，如找到则进行分配；
   \   00000002   0x2500             MOVS     R5,#+0
   \   00000004   0xE000             B.N      ??osal_add_Task_0
   \                     ??osal_add_Task_1: (+1)
   \   00000006   0x1C6D             ADDS     R5,R5,#+1
   \                     ??osal_add_Task_0: (+1)
   \   00000008   0xB2ED             UXTB     R5,R5
   \   0000000A   0x462E             MOV      R6,R5
   \   0000000C   0x2E0A             CMP      R6,#+10
   \   0000000E   0xDA08             BGE.N    ??osal_add_Task_2
    138                  if ( !Task[idx].pfnEventProcessor ) {
   \   00000010   0x....             LDR.N    R7,??DataTable4
   \   00000012   0xEB06 0x0C46      ADD      R12,R6,R6, LSL #+1
   \   00000016   0xEB07 0x06CC      ADD      R6,R7,R12, LSL #+3
   \   0000001A   0x68B7             LDR      R7,[R6, #+8]
   \   0000001C   0x2F00             CMP      R7,#+0
   \   0000001E   0xD1F2             BNE.N    ??osal_add_Task_1
    139                      TaskNew = &Task[idx];
   \   00000020   0x4634             MOV      R4,R6
    140                      break;
    141                  }
    142              }
    143          #endif
    144              if(TaskNew) {
   \                     ??osal_add_Task_2: (+1)
   \   00000022   0x2C00             CMP      R4,#+0
   \   00000024   0xD015             BEQ.N    ??osal_add_Task_3
    145                  TaskNew->pfnInit =                      pfnInit;
   \   00000026   0x6060             STR      R0,[R4, #+4]
    146                  TaskNew->pfnEventProcessor =            pfnEventProcessor;
   \   00000028   0x60A1             STR      R1,[R4, #+8]
    147                  TaskNew->taskID =                       id;//Task_id++;
   \   0000002A   0x60E3             STR      R3,[R4, #+12]
    148                  TaskNew->events =                       0;
   \   0000002C   0x2000             MOVS     R0,#+0
   \   0000002E   0x6160             STR      R0,[R4, #+20]
    149                  TaskNew->taskPriority =                 taskPriority;
   \   00000030   0x7422             STRB     R2,[R4, #+16]
    150                  TaskNew->next =                         (OsalTadkREC_t *)NULL;
   \   00000032   0x6020             STR      R0,[R4, #+0]
    151          
    152                  TaskPTR = &TaskHead;
   \   00000034   0x....             LDR.N    R0,??DataTable4_1
    153                  TaskSech = TaskHead;
   \   00000036   0x6801             LDR      R1,[R0, #+0]
   \   00000038   0xE001             B.N      ??osal_add_Task_4
    154          
    155                  while(TaskSech)  {
    156                      if(TaskNew->taskPriority > TaskSech->taskPriority) {
    157                          TaskNew->next = TaskSech;
    158                          *TaskPTR = TaskNew;
    159                          return;
    160                      }
    161                      TaskPTR = &TaskSech->next;
   \                     ??osal_add_Task_5: (+1)
   \   0000003A   0x4608             MOV      R0,R1
    162                      TaskSech = TaskSech->next;
   \   0000003C   0x6809             LDR      R1,[R1, #+0]
   \                     ??osal_add_Task_4: (+1)
   \   0000003E   0x2900             CMP      R1,#+0
   \   00000040   0xD006             BEQ.N    ??osal_add_Task_6
   \   00000042   0x7C0A             LDRB     R2,[R1, #+16]
   \   00000044   0x7C23             LDRB     R3,[R4, #+16]
   \   00000046   0x429A             CMP      R2,R3
   \   00000048   0xD2F7             BCS.N    ??osal_add_Task_5
   \   0000004A   0x6021             STR      R1,[R4, #+0]
   \   0000004C   0x6004             STR      R4,[R0, #+0]
   \   0000004E   0xE000             B.N      ??osal_add_Task_3
    163                  }
    164                  *TaskPTR = TaskNew;
   \                     ??osal_add_Task_6: (+1)
   \   00000050   0x6004             STR      R4,[R0, #+0]
    165              }
    166              return;
   \                     ??osal_add_Task_3: (+1)
   \   00000052   0xBCF0             POP      {R4-R7}
   \   00000054   0x4770             BX       LR               ;; return
    167          }
    168          
    169          /*******************************************************************************
    170           * @fn      osalNextActiveTask
    171           *
    172           * @brief   This function will return the next active task.
    173           *
    174           * NOTE:    Task queue is in priority order. We can stop at the
    175           *          first task that is "ready" (events element non-zero)
    176           *
    177           * @param   none
    178           *
    179           * @return  pointer to the found task, NULL if not found
    180           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    181          OsalTadkREC_t *osalNextActiveTask( void )
    182          {
    183              OsalTadkREC_t  *TaskSech;
    184          
    185              // Start at the beginning
    186              TaskSech = TaskHead;
   \                     osalNextActiveTask: (+1)
   \   00000000   0x....             LDR.N    R0,??DataTable4_1
   \   00000002   0x6800             LDR      R0,[R0, #+0]
   \   00000004   0xE000             B.N      ??osalNextActiveTask_0
    187          
    188              // When found or not
    189              while (  TaskSech )  {
    190                  if ( TaskSech->events)  {
    191                      // task is highest priority that is ready
    192                      return  TaskSech;
    193                  }
    194                  TaskSech =  TaskSech->next;
   \                     ??osalNextActiveTask_1: (+1)
   \   00000006   0x6800             LDR      R0,[R0, #+0]
   \                     ??osalNextActiveTask_0: (+1)
   \   00000008   0x2800             CMP      R0,#+0
   \   0000000A   0xD003             BEQ.N    ??osalNextActiveTask_2
   \   0000000C   0x6941             LDR      R1,[R0, #+20]
   \   0000000E   0x2900             CMP      R1,#+0
   \   00000010   0xD0F9             BEQ.N    ??osalNextActiveTask_1
   \   00000012   0x4770             BX       LR
    195              }
    196              return NULL;
   \                     ??osalNextActiveTask_2: (+1)
   \   00000014   0x2000             MOVS     R0,#+0
   \   00000016   0x4770             BX       LR               ;; return
    197          }
    198          
    199          /*******************************************************************************
    200           * @fn      osalFindActiveTask
    201           *
    202           * @brief   This function will return the taskid task.
    203           *
    204           * NOTE:    Task queue is in priority order. We can stop at the
    205           *          first task that is "ready" (events element non-zero)
    206           *
    207           * @param   task_id
    208           *
    209           * @return  pointer to the found task, NULL if not found
    210           *******************************************************************************/

   \                                 In section .text, align 2, keep-with-next
    211          OsalTadkREC_t *osalFindTask( osalTid taskID )
    212          {
    213              OsalTadkREC_t *TaskSech;
    214              TaskSech = TaskHead;
   \                     osalFindTask: (+1)
   \   00000000   0x....             LDR.N    R1,??DataTable4_1
   \   00000002   0x6809             LDR      R1,[R1, #+0]
   \   00000004   0xE000             B.N      ??osalFindTask_0
    215              while(TaskSech) {
    216                  if(TaskSech->taskID == taskID) {
    217                          return (TaskSech);
    218                  }
    219                  TaskSech = TaskSech->next;
   \                     ??osalFindTask_1: (+1)
   \   00000006   0x6809             LDR      R1,[R1, #+0]
   \                     ??osalFindTask_0: (+1)
   \   00000008   0x2900             CMP      R1,#+0
   \   0000000A   0xD004             BEQ.N    ??osalFindTask_2
   \   0000000C   0x68CA             LDR      R2,[R1, #+12]
   \   0000000E   0x4282             CMP      R2,R0
   \   00000010   0xD1F9             BNE.N    ??osalFindTask_1
   \   00000012   0x4608             MOV      R0,R1
   \   00000014   0x4770             BX       LR
    220              }
    221              return ((OsalTadkREC_t *)NULL);
   \                     ??osalFindTask_2: (+1)
   \   00000016   0x2000             MOVS     R0,#+0
   \   00000018   0x4770             BX       LR               ;; return
    222          }

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4:
   \   00000000   0x........         DC32     Task

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable4_1:
   \   00000000   0x........         DC32     TaskHead
    223          /*******************************************************************************
    224           * 				end of file                                    *
    225           *******************************************************************************/
    226          #endif

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       0   osalFindTask
       0   osalNextActiveTask
       8   osal_Task_init
         8   -- Indirect call
      16   osal_add_Task
       0   osal_init_TaskHead


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable4
       4  ??DataTable4_1
      28  Osal_EvtSem
     240  Task
      12  TaskHead
          TaskActive
          Task_id
      26  osalFindTask
      24  osalNextActiveTask
      32  osal_Task_init
      86  osal_add_Task
      46  osal_init_TaskHead

 
 280 bytes in section .bss
 222 bytes in section .text
 
 222 bytes of CODE memory
 280 bytes of DATA memory

Errors: none
Warnings: none
